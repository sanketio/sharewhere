/* 
 * WordPress Location Share 
 * @package WPLS 
 */
var wpls_main_object,initialLocation,browserSupportFlag=new Boolean,marker,geocoder,infowindow,wpls_main_magnific_popup,wpls_main_location_types=new Array;!function(a){wpls_main_object={main_init:function(){wpls_main_object.wpls_main_load_google_map()},wpls_main_load_google_map:function(){a("#wp-location-share-map").magnificPopup({type:"inline",modal:!1,callbacks:{open:function(){wpls_main_object.wpls_main_google_map_intialize()}}}),wpls_main_magnific_popup=a.magnificPopup.instance},wpls_main_google_map_intialize:function(){a("#wpls-location-type").removeClass("wpls-location-type-error");var b=new google.maps.LatLng(18.5204393,73.8567347),c={zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1},d=new google.maps.Map(document.getElementById("wpls-google-map"),c);navigator.geolocation?(browserSupportFlag=!0,navigator.geolocation.getCurrentPosition(function(a){wpls_main_object.wpls_main_markOutLocation(d,a.coords.latitude,a.coords.longitude)},function(){wpls_main_object.wpls_main_handle_no_geo_location(browserSupportFlag,b)})):(browserSupportFlag=!1,wpls_main_object.wpls_main_handle_no_geo_location(browserSupportFlag,b)),wpls_main_object.wpls_main_search_google_map(d)},wpls_main_handle_no_geo_location:function(a,b){1==a?(alert(wpls_main_strings.wpls_main_geolocation_service_failed),initialLocation=b):(alert(wpls_main_strings.wpls_main_geolocation_not_supported_browser),initialLocation=b),map.setCenter(initialLocation)},wpls_main_markOutLocation:function(a,b,c){geocoder=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow;var d=new google.maps.LatLng(b,c);geocoder.geocode({location:d},function(b,c){c==google.maps.GeocoderStatus.OK?b[1]?(a.setCenter(d,17),marker=new google.maps.Marker({position:d,draggable:!0,map:a}),infowindow.setContent(b[0].formatted_address),infowindow.open(a,marker),wpls_main_object.wpls_main_store_location(b[0]),google.maps.event.addListener(marker,"dragend",function(b){wpls_main_object.wpls_main_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(marker,"click",function(b){wpls_main_object.wpls_main_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(a,"click",function(b){wpls_main_object.wpls_main_geocodePosition(a,b.latLng)})):window.alert(wpls_main_strings.wpls_main_no_result_found):window.alert(wpls_main_strings.wpls_main_geocoder_failed+" "+c)})},wpls_main_geocodePosition:function(a,b){geocoder.geocode({latLng:b},function(c){c&&c.length>0?(marker.formatted_address=c[0].formatted_address,wpls_main_object.wpls_main_store_location(c[0])):marker.formatted_address=wpls_main_strings.wpls_main_not_determine_location,a.setCenter(b,17),marker.setPosition(b),infowindow.setContent(marker.formatted_address),infowindow.open(a,marker)})},wpls_main_search_google_map:function(a){var b=document.getElementById("wpls-map-search"),c=new google.maps.places.Autocomplete(b);c.bindTo("bounds",a),google.maps.event.addListener(c,"place_changed",function(){var b=c.getPlace();if(!b.geometry)return void window.alert(wpls_main_strings.wpls_main_autocomplete_no_geometry);var d=b.geometry.location.G,e=b.geometry.location.K,f=new google.maps.LatLng(d,e);wpls_main_object.wpls_main_geocodePosition(a,f)})},wpls_main_store_location:function(b){for(var c,d,e,f=0;f<b.address_components.length;f++)"locality"==b.address_components[f].types[0]?c=b.address_components[f]:"administrative_area_level_1"==b.address_components[f].types[0]?d=b.address_components[f]:"country"==b.address_components[f].types[0]&&(e=b.address_components[f]);a("#wpls-city").val(c.long_name),a("#wpls-state").val(d.long_name),a("#wpls-country").val(e.long_name),a("#wpls-store-location").val(b.formatted_address)},wpls_main_append_location:function(b){if(""==b){var c=confirm(wpls_main_strings.wpls_main_full_address_confirmation);if(!c)return void a("#wpls-location-type").addClass("wpls-location-type-error");b="full",a("#wpls-location-type").removeClass("wpls-location-type-error")}var d=wpls_main_object.wpls_main_final_location(b),e='<a class="wpls-map" title="'+d+'" href="https://google.com/maps?q='+decodeURIComponent(d)+'" target="_blank">'+d+"</a>";jQuery("textarea#comment").length>0?jQuery("textarea#comment").val(jQuery("textarea#comment").val()+" "+e):jQuery("textarea#whats-new").length>0&&jQuery("textarea#whats-new").val(jQuery("textarea#whats-new").val()+" "+e),a("#wpls-location-type").val(""),wpls_main_magnific_popup.close()},wpls_main_final_location:function(b){var c=a("#wpls-city").val(),d=a("#wpls-state").val(),e=a("#wpls-country").val(),f=a("#wpls-store-location").val();return wpls_main_location_types.city=c,wpls_main_location_types.state=d,wpls_main_location_types.country=e,wpls_main_location_types["city-state"]=c+", "+d,wpls_main_location_types["city-country"]=c+", "+e,wpls_main_location_types["state-country"]=d+", "+e,wpls_main_location_types["city-state-country"]=c+", "+d+", "+e,wpls_main_location_types.full=f,wpls_main_location_types[b]}},a("document").ready(function(){wpls_main_object.main_init(),a("#wpls-insert-button").click(function(b){b.preventDefault();var c=a("#wpls-location-type").val();wpls_main_object.wpls_main_append_location(c)})})}(jQuery);